{% extends 'base.html' %}

{% block title %}Список партнеров{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2>Список партнеров</h2>
    <a href="{% url 'partners:partner_add' %}" class="btn">Добавить партнера</a>
</div>
<div style="background-color: #F4E8D3; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
    <form method="get" style="display: flex; gap: 1rem; align-items: end;">
        <div class="form-group" style="flex: 1;">
            <label for="search">Поиск по наименованию:</label>
            <input type="text" id="search" name="search" class="form-control" 
                   value="{{ request.GET.search }}" placeholder="Введите название компании...">
        </div>
        <div class="form-group">
            <label for="partner_type">Тип партнера:</label>
            <select id="partner_type" name="partner_type" class="form-control">
                <option value="">Все типы</option>
                {% for type in partner_types %}
                <option value="{{ type.id }}" 
                       {% if request.GET.partner_type == type.id|stringformat:"i" %}selected{% endif %}>
                    {{ type.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn">Применить</button>
    </form>
</div>
<table class="table">
    <thead>
        <tr>
            <th>Наименование</th>
            <th>Тип партнера</th>
            <th>Рейтинг</th>
            <th>Телефон</th>
            <th>Email</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for partner in partners %}
        <tr>
            <td>{{ partner.name }}</td>
            <td>{{ partner.partner_type.name }}</td>
            <td>{{ partner.rating }}</td>
            <td>{{ partner.phone }}</td>
            <td>{{ partner.email }}</td>
            <td>
                <a href="{% url 'partners:partner_edit' partner.pk %}" class="btn" style="margin-right: 0.5rem;">
                    Редактировать
                </a>
                <a href="{% url 'partners:sales_history' partner.pk %}" class="btn">
                    История продаж
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" style="text-align: center;">Партнеры не найдены</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if is_paginated %}
<div style="display: flex; justify-content: center; margin-top: 2rem;">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
       class="btn" style="margin-right: 0.5rem;">Назад</a>
    {% endif %}
    
    <span style="padding: 0.5rem 1rem;">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
    
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
       class="btn" style="margin-left: 0.5rem;">Вперед</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}